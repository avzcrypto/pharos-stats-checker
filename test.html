<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharos Testnet Leaderboard - Live Rankings & Analytics</title>
    <meta name="description" content="üèÜ Live Pharos testnet leaderboard! Track top performers, analyze activity patterns & discover ecosystem leaders. Real-time rankings & stats.">
    <link rel="canonical" href="https://pharoshub.xyz/leaderboard">
    <link rel="icon" type="image/webp" href="./leaderboard_logo.webp">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Modern Reset & Base */
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#0f0f23 0%,#1a1a2e 50%,#16213e 100%);min-height:100vh;color:#e2e8f0;overflow-x:hidden}

        /* CSS Variables */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --card-bg: rgba(15, 23, 42, 0.8);
            --card-border: rgba(148, 163, 184, 0.1);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-accent: #38bdf8;
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            --animation-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --animation-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        // Animation helper  
        function animateValue(element, start, end, duration = 2000) {
            const startTime = performance.now();
            const range = end - start;

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeProgress = 1 - Math.pow(1 - progress, 3); // Ease out cubic
                const current = start + (range * easeProgress);
                
                element.textContent = formatNumber(Math.floor(current));
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        /* Container & Layout */
        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header Section */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 24px 32px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 900;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header-content h1 {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #f1f5f9, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }

        .header-content p {
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 500;
        }

        .header-stats {
            display: flex;
            gap: 24px;
        }

        .stat-item {
            text-align: center;
            padding: 16px 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            transition: var(--animation-normal);
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: rgba(255,255,255,0.08);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Analytics Section */
        .analytics-section {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .distribution-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 24px;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
        }

        .distribution-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            transition: var(--animation-normal);
        }

        .legend-item:hover {
            background: rgba(255,255,255,0.06);
            transform: translateX(4px);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 12px;
        }

        .legend-text {
            flex: 1;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .legend-count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-accent);
        }

        /* Live Status */
        .live-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Main Leaderboard */
        .leaderboard-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 32px;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 16px;
            border: 1px solid var(--card-border);
            background: rgba(0,0,0,0.2);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .leaderboard-table th {
            padding: 16px 12px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid var(--card-border);
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .leaderboard-table th.center { text-align: center; }

        .leaderboard-table tbody tr {
            transition: var(--animation-fast);
            border-bottom: 1px solid rgba(148, 163, 184, 0.05);
        }

        .leaderboard-table tbody tr:hover {
            background: rgba(255,255,255,0.03);
            transform: scale(1.005);
        }

        .leaderboard-table td {
            padding: 16px 12px;
            vertical-align: middle;
            color: var(--text-secondary);
        }

        .leaderboard-table td.center { text-align: center; }

        /* Rank Styling */
        .rank {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 900;
            font-size: 16px;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .rank-1 { background: linear-gradient(135deg, #ffd700, #ffed4a); color: #1a202c; }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0, #e2e8f0); color: #1a202c; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #d69e2e); color: white; }
        .rank-top10 { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .rank-top50 { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
        .rank-default { background: rgba(255,255,255,0.1); color: var(--text-secondary); }

        /* Address */
        .address {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: var(--text-accent);
            font-weight: 600;
        }

        /* Points & Level */
        .points-level {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .points {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 16px;
        }

        .level-badge {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .level-1 { background: linear-gradient(135deg, #6b7280, #9ca3af); color: white; }
        .level-2 { background: linear-gradient(135deg, #059669, #10b981); color: white; }
        .level-3 { background: linear-gradient(135deg, #0284c7, #0ea5e9); color: white; }
        .level-4 { background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; }
        .level-5 { background: linear-gradient(135deg, #dc2626, #ef4444); color: white; }

        /* Protocol Sections */
        .protocol-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .protocol-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            object-fit: cover;
        }

        .protocol-stats {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .protocol-main {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 14px;
        }

        .protocol-sub {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Season 2 Badge */
        .season2-badge {
            background: var(--warning-gradient);
            color: #1a202c;
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 4px;
        }

        /* Loading & Error States */
        .loading {
            display: none;
            text-align: center;
            padding: 80px 20px;
        }

        .loading.show { display: block; }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(255,255,255,0.1);
            border-left: 4px solid var(--text-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-state {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin: 20px 0;
        }

        .error-title {
            font-size: 18px;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 8px;
        }

        .error-message {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .retry-btn {
            background: var(--danger-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--animation-normal);
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 32px;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid var(--card-border);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--animation-normal);
            min-width: 40px;
            text-align: center;
        }

        .pagination-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .pagination-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }

        .pagination-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .analytics-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }

        @media (max-width: 768px) {
            .container { padding: 16px; }
            
            .header {
                padding: 20px;
            }
            
            .header-content h1 {
                font-size: 24px;
            }
            
            .header-stats {
                flex-direction: column;
                gap: 12px;
                width: 100%;
            }
            
            .stat-item {
                padding: 12px 16px;
            }
            
            .leaderboard-section {
                padding: 20px;
            }
            
            .section-title {
                font-size: 20px;
            }
        }

        /* Smooth Scrolling */
        html { scroll-behavior: smooth; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">üèÜ</div>
                <div class="header-content">
                    <h1>Pharos Leaderboard</h1>
                    <p>Live rankings & ecosystem analytics</p>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalChecks">0</div>
                    <div class="stat-label">API Calls</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="topScore">0</div>
                    <div class="stat-label">Top Score</div>
                </div>
            </div>
        </header>

        <!-- Analytics Section -->
        <div class="analytics-section">
            <div class="distribution-card">
                <h3 class="distribution-title">
                    üìä Point Distribution
                </h3>
                <div id="distributionLegend"></div>
            </div>
            
            <div class="distribution-card">
                <div class="live-status">
                    <div class="live-dot"></div>
                    <span style="color: #22c55e; font-weight: 600;">Live Data - Updates every hour</span>
                </div>
                <h3 class="distribution-title">
                    üöÄ Ecosystem Overview
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-top: 16px;">
                    <div class="legend-item">
                        <div style="text-align: center;">
                            <div style="font-size: 20px; margin-bottom: 4px;">üìà</div>
                            <div class="legend-count" id="activeUsers">0</div>
                            <div style="font-size: 11px; color: var(--text-secondary);">Active Users</div>
                        </div>
                    </div>
                    <div class="legend-item">
                        <div style="text-align: center;">
                            <div style="font-size: 20px; margin-bottom: 4px;">‚ö°</div>
                            <div class="legend-count" id="topPerformers">0</div>
                            <div style="font-size: 11px; color: var(--text-secondary);">Top 10%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p style="color: var(--text-secondary); font-size: 16px; font-weight: 500;">Loading leaderboard data...</p>
        </div>

        <!-- Error State -->
        <div class="error-state" id="errorState" style="display: none;">
            <div class="error-title">‚ö†Ô∏è Connection Error</div>
            <div class="error-message">Unable to load leaderboard data. Please try again.</div>
            <button class="retry-btn" onclick="loadLeaderboard()">Retry</button>
        </div>

        <!-- Main Leaderboard -->
        <div class="leaderboard-section" id="leaderboardSection">
            <div class="section-header">
                <h2 class="section-title">
                    üèÜ Top 100 Users
                </h2>
            </div>
            
            <div class="table-container">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th class="center">Rank</th>
                            <th>User</th>
                            <th class="center">Points & Level</th>
                            <th class="center">Send TX</th>
                            <th class="center">Zenith DEX</th>
                            <th class="center">Faroswap</th>
                            <th class="center">NFT/Domains</th>
                            <th class="center">Season 2 üöÄ</th>
                            <th class="center">Member Since</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Dynamic content will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <button class="pagination-btn" id="prevBtn" disabled>‚Üê Prev</button>
                <button class="pagination-btn active" data-page="1">1</button>
                <button class="pagination-btn" data-page="2">2</button>
                <button class="pagination-btn" data-page="3">3</button>
                <button class="pagination-btn" data-page="4">4</button>
                <button class="pagination-btn" data-page="5">5</button>
                <button class="pagination-btn" id="nextBtn">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentPage = 1;
        let leaderboardData = [];
        let allUsers = []; // All 100 users from API
        let totalUsers = 0;
        let isLoading = false;
        let lastUpdated = null; // Track when data was last updated
        let updateTimer = null; // Timer for updating time display
        const USERS_PER_PAGE = 20;
        const TOTAL_PAGES = 5;
        const CACHE_DURATION = 60 * 60 * 1000; // 1 hour in milliseconds

        // DOM elements
        const elements = {
            loading: document.getElementById('loading'),
            errorState: document.getElementById('errorState'),
            leaderboardSection: document.getElementById('leaderboardSection'),
            leaderboardBody: document.getElementById('leaderboardBody'),
            totalUsers: document.getElementById('totalUsers'),
            totalChecks: document.getElementById('totalChecks'),
            topScore: document.getElementById('topScore'),
            activeUsers: document.getElementById('activeUsers'),
            topPerformers: document.getElementById('topPerformers'),
            distributionLegend: document.getElementById('distributionLegend'),
            pagination: document.getElementById('pagination'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            lastUpdatedInfo: null // Will be created dynamically
        };

        // Utility functions
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatAddress(address) {
            return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            try {
                return new Date(dateString).toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
            } catch {
                return 'Unknown';
            }
        }

        function getRankClass(rank) {
            if (rank === 1) return 'rank-1';
            if (rank === 2) return 'rank-2';
            if (rank === 3) return 'rank-3';
            if (rank <= 10) return 'rank-top10';
            if (rank <= 50) return 'rank-top50';
            return 'rank-default';
        }

        function getLevelClass(level) {
            return `level-${Math.min(level, 5)}`;
        }

        // Time formatting utilities
        function formatTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / (1000 * 60));
            
            if (minutes < 1) return 'just now';
            if (minutes === 1) return '1 minute ago';
            if (minutes < 60) return `${minutes} minutes ago`;
            
            const hours = Math.floor(minutes / 60);
            if (hours === 1) return '1 hour ago';
            return `${hours} hours ago`;
        }

        function formatTimeUntilNext(timestamp) {
            const nextUpdate = timestamp + CACHE_DURATION;
            const now = Date.now();
            const diff = nextUpdate - now;
            
            if (diff <= 0) return 'updating soon...';
            
            const minutes = Math.floor(diff / (1000 * 60));
            if (minutes < 1) return 'less than 1 minute';
            if (minutes === 1) return '1 minute';
            if (minutes < 60) return `${minutes} minutes`;
            
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;
            if (hours === 1) {
                return remainingMinutes > 0 ? `1 hour ${remainingMinutes} minutes` : '1 hour';
            }
            return remainingMinutes > 0 ? `${hours} hours ${remainingMinutes} minutes` : `${hours} hours`;
        }

        // Create or update last updated info
        function updateLastUpdatedInfo() {
            if (!lastUpdated) return;

            if (!elements.lastUpdatedInfo) {
                // Create the info element
                const infoElement = document.createElement('div');
                infoElement.className = 'last-updated-info';
                infoElement.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 8px 16px;
                    background: rgba(34, 197, 94, 0.1);
                    border: 1px solid rgba(34, 197, 94, 0.2);
                    border-radius: 12px;
                    font-size: 13px;
                    color: var(--text-secondary);
                    margin-bottom: 16px;
                `;
                
                // Insert before the table container
                const tableContainer = document.querySelector('.table-container');
                tableContainer.parentNode.insertBefore(infoElement, tableContainer);
                elements.lastUpdatedInfo = infoElement;
            }

            // Update the content
            const timeAgo = formatTimeAgo(lastUpdated);
            const timeUntilNext = formatTimeUntilNext(lastUpdated);
            
            elements.lastUpdatedInfo.innerHTML = `
                <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite;"></div>
                <span style="color: #22c55e; font-weight: 600;">Last updated:</span>
                <span>${timeAgo}</span>
                <span style="color: var(--text-secondary);">‚Ä¢</span>
                <span>Next refresh in ${timeUntilNext}</span>
            `;
        }

        // Start update timer
        function startUpdateTimer() {
            // Clear existing timer
            if (updateTimer) {
                clearInterval(updateTimer);
            }

            // Update immediately
            updateLastUpdatedInfo();

            // Update every minute
            updateTimer = setInterval(() => {
                updateLastUpdatedInfo();
            }, 60 * 1000);
        }

        // Stop update timer
        function stopUpdateTimer() {
            if (updateTimer) {
                clearInterval(updateTimer);
                updateTimer = null;
            }
        }
        function animateValue(element, start, end, duration = 2000) {
            const startTime = performance.now();
            const range = end - start;

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeProgress = 1 - Math.pow(1 - progress, 3); // Ease out cubic
                const current = start + (range * easeProgress);
                
                element.textContent = formatNumber(Math.floor(current));
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        // Show/hide states
        function showLoading() {
            elements.loading.classList.add('show');
            elements.errorState.style.display = 'none';
            elements.leaderboardSection.style.display = 'none';
        }

        function showError() {
            elements.loading.classList.remove('show');
            elements.errorState.style.display = 'block';
            elements.leaderboardSection.style.display = 'none';
        }

        function showLeaderboard() {
            elements.loading.classList.remove('show');
            elements.errorState.style.display = 'none';
            elements.leaderboardSection.style.display = 'block';
        }

        // Create distribution legend
        function createDistributionLegend(pointDistribution) {
            const colors = [
                '#ef4444', '#f97316', '#eab308', '#22c55e', 
                '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899', '#6b7280'
            ];
            
            const entries = Object.entries(pointDistribution);
            let html = '';
            
            entries.forEach(([range, count], index) => {
                const percentage = totalUsers > 0 ? ((count / totalUsers) * 100).toFixed(1) : '0.0';
                html += `
                    <div class="legend-item">
                        <div style="display: flex; align-items: center;">
                            <div class="legend-color" style="background: ${colors[index % colors.length]}"></div>
                            <span class="legend-text">${range} pts</span>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-end;">
                            <span class="legend-count">${formatNumber(count)}</span>
                            <span style="font-size: 11px; color: var(--text-secondary);">${percentage}%</span>
                        </div>
                    </div>
                `;
            });
            
            elements.distributionLegend.innerHTML = html;
        }

        // Create leaderboard row
        function createLeaderboardRow(user, globalIndex) {
            const rank = globalIndex + 1; // Global rank (1-100)
            const season2Total = (user.primuslabs_send || 0) + (user.aquaflux || 0) + 
                               (user.autostaking || 0) + (user.fiamma_bridge || 0) + (user.brokex || 0);
            
            return `
                <tr style="animation: fadeInUp 0.6s ease-out ${(globalIndex % USERS_PER_PAGE) * 0.05}s both;">
                    <td class="center">
                        <div class="rank ${getRankClass(rank)}">${rank}</div>
                    </td>
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <span class="address">${formatAddress(user.address)}</span>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span style="font-size: 11px; color: var(--text-secondary);">
                                    Checks: ${user.total_checks || 1}
                                </span>
                                ${user.first_check ? `
                                    <span style="font-size: 10px; padding: 2px 6px; background: rgba(34,197,94,0.1); 
                                          color: #22c55e; border-radius: 4px;">
                                        Early User
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </td>
                    <td class="center">
                        <div class="points-level">
                            <span class="points">${formatNumber(user.total_points)}</span>
                            <span class="level-badge ${getLevelClass(user.current_level)}">
                                LVL ${user.current_level}
                            </span>
                        </div>
                    </td>
                    <td class="center">
                        <div class="protocol-cell">
                            <div class="protocol-stats">
                                <span class="protocol-main">${formatNumber(user.send_count || 0)}</span>
                                <span class="protocol-sub">transactions</span>
                            </div>
                        </div>
                    </td>
                    <td class="center">
                        <div class="protocol-cell">
                            <div class="protocol-stats">
                                <span class="protocol-main">${formatNumber((user.swap_count || 0) + (user.lp_count || 0))}</span>
                                <span class="protocol-sub">${user.swap_count || 0} swaps ‚Ä¢ ${user.lp_count || 0} LP</span>
                            </div>
                        </div>
                    </td>
                    <td class="center">
                        <div class="protocol-cell">
                            <div class="protocol-stats">
                                <span class="protocol-main">${formatNumber((user.faroswap_swaps || 0) + (user.faroswap_lp || 0))}</span>
                                <span class="protocol-sub">${user.faroswap_swaps || 0} swaps ‚Ä¢ ${user.faroswap_lp || 0} LP</span>
                            </div>
                        </div>
                    </td>
                    <td class="center">
                        <div class="protocol-cell">
                            <div class="protocol-stats">
                                <span class="protocol-main">${formatNumber((user.mint_domain || 0) + (user.mint_nft || 0))}</span>
                                <span class="protocol-sub">${user.mint_domain || 0} domains ‚Ä¢ ${user.mint_nft || 0} NFTs</span>
                            </div>
                        </div>
                    </td>
                    <td class="center">
                        <div class="protocol-cell">
                            <div class="protocol-stats">
                                <span class="protocol-main">${formatNumber(season2Total)}</span>
                                <span class="protocol-sub">
                                    ${user.primuslabs_send || 0} sends ‚Ä¢ ${user.aquaflux || 0} DeFi ‚Ä¢ ${user.autostaking || 0} stake
                                </span>
                                ${season2Total > 0 ? '<span class="season2-badge">LIVE</span>' : ''}
                            </div>
                        </div>
                    </td>
                    <td class="center">
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${formatDate(user.member_since)}
                        </div>
                    </td>
                </tr>
            `;
        }

        // Update statistics
        function updateStatistics(data) {
            if (!data.success) return;

            // Animate main stats
            animateValue(elements.totalUsers, 0, data.total_users || 0);
            animateValue(elements.totalChecks, 0, data.total_checks || 0);
            
            if (data.leaderboard && data.leaderboard.length > 0) {
                animateValue(elements.topScore, 0, data.leaderboard[0].total_points || 0);
            }

            // Calculate derived stats
            const activeUsersCount = data.leaderboard ? data.leaderboard.filter(u => u.total_points > 1000).length : 0;
            const topPerformersCount = Math.ceil((data.total_users || 0) * 0.1);
            
            animateValue(elements.activeUsers, 0, activeUsersCount);
            animateValue(elements.topPerformers, 0, topPerformersCount);

            // Update distribution
            if (data.point_distribution) {
                createDistributionLegend(data.point_distribution);
            }

            totalUsers = data.total_users || 0;
        }

        // Render leaderboard with pagination
        function renderLeaderboard() {
            console.log(`üîÑ Rendering leaderboard. allUsers length: ${allUsers ? allUsers.length : 'undefined'}`);
            
            if (!allUsers || allUsers.length === 0) {
                console.log('‚ùå No users data available for rendering');
                elements.leaderboardBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No Data Available</div>
                            <div>Leaderboard data is being updated. Please check back soon.</div>
                        </td>
                    </tr>
                `;
                return;
            }

            // Calculate pagination
            const startIndex = (currentPage - 1) * USERS_PER_PAGE;
            const endIndex = startIndex + USERS_PER_PAGE;
            const currentPageUsers = allUsers.slice(startIndex, endIndex);

            console.log(`üìÑ Rendering page ${currentPage}: users ${startIndex + 1}-${Math.min(endIndex, allUsers.length)} of ${allUsers.length}`);
            console.log(`üîç Current page users:`, currentPageUsers.length);

            // Generate rows with global indices for correct ranks
            const rowsHtml = currentPageUsers.map((user, localIndex) => {
                const globalIndex = startIndex + localIndex;
                return createLeaderboardRow(user, globalIndex);
            }).join('');

            elements.leaderboardBody.innerHTML = rowsHtml;
            
            // Update pagination info
            updatePaginationInfo();
            
            // Add fade in animation styles if not already added
            if (!document.querySelector('#fadeInUpStyles')) {
                const style = document.createElement('style');
                style.id = 'fadeInUpStyles';
                style.textContent = `
                    @keyframes fadeInUp {
                        from {
                            opacity: 0;
                            transform: translate3d(0, 20px, 0);
                        }
                        to {
                            opacity: 1;
                            transform: translate3d(0, 0, 0);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Update pagination info
        function updatePaginationInfo() {
            const startRank = (currentPage - 1) * USERS_PER_PAGE + 1;
            const endRank = Math.min(currentPage * USERS_PER_PAGE, allUsers.length);
            
            // Update section title with current page info
            const sectionTitle = document.querySelector('.section-title');
            if (sectionTitle) {
                sectionTitle.innerHTML = `
                    üèÜ Top 100 Users
                    <span style="font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-left: 12px;">
                        Showing ranks ${startRank}-${endRank}
                    </span>
                `;
            }
        }

        // Load leaderboard data
        async function loadLeaderboard() {
            if (isLoading) return;
            
            isLoading = true;
            showLoading();

            try {
                const response = await fetch('/api/admin/stats', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load leaderboard data');
                }

                // Store data and timestamp
                leaderboardData = data;
                allUsers = data.leaderboard || []; // Store all 100 users
                lastUpdated = Date.now(); // Record when data was loaded

                console.log(`üìä Loaded ${allUsers.length} users from API`);

                // Update UI
                updateStatistics(data);
                renderLeaderboard(); // Now uses allUsers and currentPage
                startUpdateTimer(); // Start the update info timer
                showLeaderboard();

                console.log('‚úÖ Leaderboard loaded successfully:', {
                    users: data.total_users,
                    checks: data.total_checks,
                    topScore: data.leaderboard?.[0]?.total_points || 0,
                    leaderboardLength: allUsers.length
                });

            } catch (error) {
                console.error('‚ùå Error loading leaderboard:', error);
                stopUpdateTimer(); // Stop timer on error
                showError();
            } finally {
                isLoading = false;
            }
        }

        // Pagination handlers
        function setupPagination() {
            const paginationBtns = document.querySelectorAll('.pagination-btn[data-page]');
            
            paginationBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = parseInt(btn.dataset.page);
                    if (page !== currentPage) {
                        changePage(page);
                    }
                });
            });

            elements.prevBtn.addEventListener('click', () => {
                if (currentPage > 1) changePage(currentPage - 1);
            });

            elements.nextBtn.addEventListener('click', () => {
                if (currentPage < TOTAL_PAGES) changePage(currentPage + 1);
            });
        }

        function changePage(page) {
            if (page === currentPage || page < 1 || page > TOTAL_PAGES) return;
            
            console.log(`üìÑ Changing from page ${currentPage} to page ${page}`);
            
            currentPage = page;
            updatePaginationUI();
            renderLeaderboard(); // Re-render with new page data
            
            // Smooth scroll to top of leaderboard
            elements.leaderboardSection.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function updatePaginationUI() {
            // Update active button
            document.querySelectorAll('.pagination-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.page === currentPage.toString()) {
                    btn.classList.add('active');
                }
            });

            // Update prev/next buttons
            elements.prevBtn.disabled = currentPage === 1;
            elements.nextBtn.disabled = currentPage === TOTAL_PAGES;
            
            console.log(`üîÑ Updated pagination UI: page ${currentPage}/${TOTAL_PAGES}`);
        }

        // Auto-refresh functionality - REMOVED
        // No longer needed since we use 1-hour cache consistently

        // Initialize app
        async function initializeApp() {
            console.log('üöÄ Initializing Pharos Leaderboard...');
            
            // Setup event listeners
            setupPagination();
            
            // Load initial data
            await loadLeaderboard();
            
            console.log('‚úÖ Pharos Leaderboard initialized successfully');
        }
        }

        // Error handling for network issues
        window.addEventListener('online', () => {
            if (!isLoading && elements.errorState.style.display !== 'none') {
                console.log('üåê Network restored, reloading data...');
                loadLeaderboard();
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopUpdateTimer();
        });

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Expose for debugging
        window.pharosLeaderboard = {
            loadLeaderboard,
            data: () => leaderboardData,
            refresh: () => loadLeaderboard()
        };
    </script>
</body>
</html>
