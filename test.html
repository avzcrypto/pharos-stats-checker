<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharos Stats Leaderboard - Top Users & Rankings</title>
    <meta name="description" content="üèÜ View the Pharos Testnet leaderboard! Check top users, rankings, and see where you stand among thousands of participants.">
    <meta name="author" content="avzcrypto">
    <meta name="theme-color" content="#3b82f6">
    <meta name="color-scheme" content="light">
    
    <!-- Canonical & Icons -->
    <link rel="canonical" href="https://pharoshub.xyz/leaderboard">
    <link rel="icon" type="image/webp" href="./leaderboard_logo.webp">
    
    <!-- Font Optimization -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"></noscript>
    
    <!-- Open Graph -->
    <meta property="og:title" content="Pharos Stats Leaderboard - Top Users & Rankings">
    <meta property="og:description" content="üèÜ View the Pharos Testnet leaderboard! Check top users, rankings, and see where you stand.">
    <meta property="og:image" content="https://pharoshub.xyz/leaderboard_logo.webp">
    <meta property="og:url" content="https://pharoshub.xyz/leaderboard">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Pharos Stats Leaderboard">
    <meta name="twitter:description" content="üèÜ View the Pharos Testnet leaderboard!">
    <meta name="twitter:image" content="https://pharoshub.xyz/leaderboard_logo.webp">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": ["WebApplication", "RankingTable"],
      "name": "Pharos Stats Leaderboard",
      "description": "View the Pharos Testnet leaderboard with top users, rankings, and comprehensive statistics.",
      "url": "https://pharoshub.xyz/leaderboard",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Web Browser",
      "author": {
        "@type": "Person",
        "name": "avzcrypto"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://pharoshub.xyz/leaderboard?address={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <style>
        /* Performance Optimizations */
        html {
            scroll-behavior: smooth;
        }
        
        /* CSS Reset - Optimized */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Root Variables */
        :root {
            --pharos-blue-500: #3b82f6;
            --pharos-blue-600: #2563eb;
            --pharos-blue-700: #1d4ed8;
            --pharos-blue-800: #1e3a8a;
            --pharos-green-500: #22c55e;
            --pharos-green-600: #16a34a;
            --pharos-gray-500: #64748b;
            --pharos-gray-700: #374151;
            --pharos-gray-900: #1f2937;
            --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.06), 0 4px 8px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.08);
        }
        
        /* Base Styles */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f2ed 0%, #e8eaf6 30%, #e3f2fd 60%, #bbdefb 100%);
            min-height: 100vh;
            overflow-x: hidden;
            padding: 40px 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            box-sizing: border-box;
        }
        
        /* Screen Reader Only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus Styles */
        *:focus-visible {
            outline: 2px solid var(--pharos-blue-500);
            outline-offset: 2px;
            border-radius: 4px;
        }
        
        /* Progress Indicator */
        .progress-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--pharos-blue-500);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
            z-index: 1000;
            will-change: transform;
        }
        
        .progress-indicator.loading {
            animation: progressLoad 2s ease-in-out infinite;
        }
        
        @keyframes progressLoad {
            0%, 100% { transform: scaleX(0); }
            50% { transform: scaleX(0.7); }
        }
        
        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Header Section */
        .header-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
            align-items: start;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
            min-height: 160px;
        }
        
        .logo-img {
            width: 160px;
            height: 160px;
            object-fit: contain;
            flex-shrink: 0;
        }
        
        .title-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .main-title {
            font-size: 46px;
            font-weight: 900;
            color: var(--pharos-gray-900);
            line-height: 1.1;
            letter-spacing: -0.02em;
        }
        
        .header-right {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 160px;
        }
        
        .stat-card-header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: var(--transition-base);
            box-shadow: var(--shadow-md);
            contain: layout style paint;
        }
        
        .stat-card-header:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-value-header {
            font-size: 36px;
            font-weight: 900;
            color: var(--pharos-blue-800);
            margin-bottom: 8px;
            font-family: 'Inter', 'SF Mono', monospace;
            letter-spacing: -1.5px;
            line-height: 1;
        }
        
        .stat-label-header {
            font-size: 14px;
            color: var(--pharos-gray-500);
            font-weight: 600;
            letter-spacing: 0.025em;
            text-align: center;
            position: relative;
            left: 25px;
        }
        
        /* Disclaimer Section */
        .disclaimer-section {
            background: rgba(255, 248, 220, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(245, 158, 11, 0.2);
            box-shadow: var(--shadow-sm);
        }
        
        .disclaimer-content {
            font-size: 14px;
            color: #92400e;
            font-weight: 500;
            text-align: center;
            line-height: 1.4;
        }
        
        .disclaimer-link {
            color: #1d4ed8;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        .disclaimer-link:hover {
            color: #1e40af;
            text-decoration: underline;
        }
        
        /* Search Section */
        .rank-search-section {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.5);
            margin-bottom: 30px;
            contain: layout style paint;
        }
        
        .search-form {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .input-group {
            flex: 1;
            display: flex;
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            overflow: hidden;
            background: white;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .input-group:focus-within {
            border-color: var(--pharos-blue-500);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        
        .wallet-input {
            flex: 1;
            padding: 12px;
            border: none;
            outline: none;
            font-size: 14px;
            font-family: 'Inter', 'SF Mono', monospace;
            color: var(--pharos-gray-900);
            background: transparent;
            font-weight: 500;
        }
        
        .wallet-input::placeholder {
            color: var(--pharos-gray-500);
            font-weight: 400;
        }
        
        .wallet-input:invalid {
            box-shadow: none;
        }
        
        .search-button {
            padding: 12px 36px;
            background: rgb(0, 7, 185);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            box-shadow: 0 8px 16px rgba(0, 7, 185, 0.3);
            white-space: nowrap;
            min-width: 200px;
            will-change: transform;
        }
        
        .search-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 7, 185, 0.4);
        }
        
        .search-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Error and Success Messages */
        .error {
            background: rgba(255, 255, 255, 0.9);
            color: #dc2626;
            padding: 16px;
            border-radius: 16px;
            margin-top: 16px;
            display: none;
            border: 1px solid rgba(239, 68, 68, 0.2);
            font-weight: 600;
            backdrop-filter: blur(20px);
        }
        
        .error.show {
            display: block;
        }
        
        /* User Search Result */
        .user-search-result {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid rgba(34, 197, 94, 0.2);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 16px rgba(34, 197, 94, 0.1);
            display: none;
            contain: layout style paint;
        }
        
        .user-search-result.show {
            display: block;
        }
        
        .result-compact-row {
            display: grid;
            grid-template-columns: auto auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .result-stat-block {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 16px 20px;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.1);
            min-width: 150px;
            transition: var(--transition-base);
        }
        
        .result-stat-block:hover {
            transform: translateY(-2px);
        }
        
        .result-stat-value {
            font-size: 15px;
            font-weight: 800;
            margin-bottom: 4px;
            font-family: 'Inter', 'SF Mono', monospace;
        }
        
        .result-stat-label {
            font-size: 12px;
            color: var(--pharos-gray-500);
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .result-level-block {
            background: var(--pharos-green-500);
            color: white;
        }
        
        .result-level-block .result-stat-label {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .result-activities {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            flex: 1;
        }
        
        .result-activity {
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
            padding: 8px 6px;
            text-align: center;
            min-width: 75px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: var(--transition-base);
        }
        
        .result-activity:hover {
            transform: translateY(-1px);
        }
        
        .result-activity.send { 
            background: rgba(59, 130, 246, 0.08); 
            border-color: rgba(59, 130, 246, 0.15);
        }
        .result-activity.zenith { 
            background: rgba(249, 115, 22, 0.08); 
            border-color: rgba(249, 115, 22, 0.15);
        }
        .result-activity.faroswap { 
            background: rgba(168, 85, 247, 0.08); 
            border-color: rgba(168, 85, 247, 0.15);
        }
        .result-activity.nft { 
            background: rgba(34, 197, 94, 0.08); 
            border-color: rgba(34, 197, 94, 0.15);
        }
        
        .result-activity-header {
            font-size: 13px;
            color: var(--pharos-gray-500);
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
        }
        
        .result-activity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-bottom: 4px;
        }
        
        .result-activity-single {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .result-activity-item {
            text-align: center;
        }
        
        .result-activity-value {
            font-size: 15px;
            font-weight: 800;
            color: var(--pharos-gray-900);
            margin-bottom: 2px;
            font-family: 'Inter', 'SF Mono', monospace;
        }
        
        .result-activity-sublabel {
            font-size: 12px;
            color: var(--pharos-gray-500);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .rank-info {
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid var(--pharos-green-500);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            transition: var(--transition-base);
        }
        
        .rank-info:hover {
            background: rgba(34, 197, 94, 0.15);
        }
        
        .rank-text {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 8px;
            font-family: 'Inter', 'SF Mono', monospace;
            color: var(--pharos-green-600);
        }
        
        /* Boost CTA Block */
        .boost-cta {
            background: url('./form_background.webp') center/cover;
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            transition: var(--transition-base);
            cursor: pointer;
            text-decoration: none;
            display: block;
            position: relative;
            margin-top: 16px;
            will-change: transform;
        }
        
        .boost-cta::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            z-index: 1;
        }
        
        .boost-cta:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 24px rgba(13, 120, 232, 0.3),
                0 6px 12px rgba(13, 120, 232, 0.2);
        }
        
        .boost-cta-content {
            position: relative;
            z-index: 2;
        }
        
        .boost-cta-text {
            font-size: 22px;
            font-weight: 900;
            letter-spacing: 0.025em;
            line-height: 1.4;
            margin: 0;
            position: relative;
            z-index: 2;
        }
        
        .boost-cta-line1 {
            background-image: linear-gradient(91deg, rgb(255, 255, 255) 23%, rgb(166, 224, 255) 98%);
            font-family: 'Inter', sans-serif;
            font-weight: 900;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(rgb(253, 255, 208) 0px 2px 40px);
            display: block;
            margin-bottom: 4px;
        }
        
        .boost-cta-line2 {
            background-image: linear-gradient(128deg, rgb(255, 215, 0) 13%, rgba(255, 223, 0, 0.9) 95%);
            font-family: 'Inter', sans-serif;
            font-weight: 900;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(rgb(253, 255, 208) 0px 2px 10px);
            display: inline;
        }
        
        .boost-cta-emoji {
            color: white;
            font-size: 22px;
            margin-left: 4px;
            display: inline;
        }
        
        /* Analytics Section */
        .analytics-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            contain: layout style paint;
        }
        
        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .analytics-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--pharos-gray-900);
        }
        
        .analytics-subtitle {
            font-size: 14px;
            color: var(--pharos-gray-500);
            font-weight: 500;
        }
        
        .analytics-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
            align-items: center;
        }
        
        /* Pie Chart */
        .pie-container {
            position: relative;
            width: 280px;
            height: 280px;
        }
        
        .pie-chart {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
            will-change: transform;
        }
        
        .pie-center-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .total-users {
            font-size: 28px;
            font-weight: 900;
            color: var(--pharos-gray-900);
            margin-bottom: 4px;
        }
        
        .total-label {
            font-size: 12px;
            color: var(--pharos-gray-500);
            font-weight: 600;
        }
        
        /* Legend */
        .pie-legend {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .legend-item {
            display: grid;
            grid-template-columns: 20px 1fr auto auto;
            gap: 12px;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
        }
        
        .legend-item:hover {
            transform: translateX(4px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            flex-shrink: 0;
        }
        
        .legend-text {
            font-weight: 600;
            font-size: 14px;
            color: var(--pharos-gray-900);
        }
        
        .legend-count {
            font-weight: 800;
            font-size: 16px;
            color: var(--pharos-gray-900);
            font-family: 'Inter', 'SF Mono', monospace;
        }
        
        .legend-percentage {
            font-weight: 600;
            font-size: 12px;
            color: var(--pharos-gray-500);
            min-width: 40px;
            text-align: right;
        }
        
        /* Tooltip */
        .pie-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            pointer-events: none;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .pie-tooltip.show {
            opacity: 1;
        }
        
        /* Leaderboard */
        .leaderboard-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            contain: layout style paint;
        }
        
        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .leaderboard-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--pharos-gray-900);
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px 6px;
            text-align: center;
            border-bottom: 1px solid rgba(203, 213, 225, 0.3);
            vertical-align: middle;
            position: relative;
        }
        
        .leaderboard-table th:first-child,
        .leaderboard-table td:first-child,
        .leaderboard-table th:nth-child(2),
        .leaderboard-table td:nth-child(2),
        .leaderboard-table th:nth-child(3),
        .leaderboard-table td:nth-child(3) {
            text-align: left;
        }
        
        .leaderboard-table th:nth-child(3),
        .leaderboard-table td:nth-child(3) {
            padding-right: 0px;
        }
        
        /* Optimized vertical separators */
        .leaderboard-table th:not(:last-child)::after,
        .leaderboard-table td:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 10%;
            bottom: 10%;
            width: 1px;
            background: rgba(203, 213, 225, 0.4);
        }
        
        .leaderboard-table th {
            background: rgba(248, 250, 252, 0.8);
            font-weight: 700;
            color: var(--pharos-gray-900);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: 12px 12px 0 0;
        }
        
        /* Leaderboard alternating row background */
        .leaderboard-table tbody tr {
            transition: var(--transition-base);
        }
        
        .leaderboard-table tbody tr:nth-child(even) {
            background: rgba(241, 245, 249, 0.8);
        }
        
        .leaderboard-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.08) !important;
            transform: translateX(4px);
        }
        
        /* Rank styling */
        .rank {
            font-weight: 800;
            font-size: 14px;
        }
        
        .rank-tier-1 { color: #ef4444; }
        .rank-tier-2 { color: #f97316; }
        .rank-tier-3 { color: #eab308; }
        .rank-tier-4 { color: #22c55e; }
        .rank-tier-5 { color: #06b6d4; }
        .rank-tier-6 { color: #3b82f6; }
        .rank-tier-7 { color: #8b5cf6; }
        .rank-tier-8 { color: #a855f7; }
        .rank-tier-9 { color: #ec4899; }
        .rank-tier-10 { color: #64748b; }
        
        .address {
            font-family: 'Inter', 'SF Mono', monospace;
            font-size: 14px;
            color: var(--pharos-blue-700);
            font-weight: 600;
        }
        
        .points-level-wrapper {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 6px 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            width: 110px;
            transition: var(--transition-base);
        }
        
        .points-level-wrapper:hover {
            transform: scale(1.02);
        }
        
        .points {
            color: var(--pharos-gray-900);
            font-size: 14px;
            font-weight: 800;
            font-family: 'Inter', 'SF Mono', monospace;
            letter-spacing: -1px;
        }
        
        .level-badge {
            background: var(--pharos-green-500);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 800;
            letter-spacing: -1px;
        }
        
        .activity-count {
            font-weight: 600;
            color: var(--pharos-gray-900);
            font-size: 14px;
        }
        
        .member-since {
            font-size: 14px;
            color: var(--pharos-gray-500);
            font-weight: 500;
        }
        
        /* Protocol blocks */
        .protocol-block {
            background: rgba(248, 250, 252, 0.6);
            border-radius: 8px;
            padding: 4px;
            margin: 2px;
            transition: var(--transition-base);
        }
        
        .protocol-block:hover {
            transform: scale(1.02);
        }
        
        .zenith-block {
            background: rgba(249, 115, 22, 0.08);
        }
        
        .faroswap-block {
            background: rgba(168, 85, 247, 0.08);
        }
        
        .nft-block {
            background: rgba(34, 197, 94, 0.08);
        }
        
        .send-block {
            background: rgba(59, 130, 246, 0.08);
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        .loading-text {
            color: var(--pharos-gray-500);
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Virtual Scrolling Container */
        .table-container {
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
            border-radius: 12px;
            position: relative;
        }
        
        .table-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.5);
            border-radius: 4px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.7);
            border-radius: 4px;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: rgba(107, 114, 128, 0.8);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
        }
        
        .pagination-button {
            padding: 8px 12px;
            border: 1px solid rgba(203, 213, 225, 0.5);
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition-base);
            min-width: 40px;
            text-align: center;
        }
        
        .pagination-button:hover:not(.disabled) {
            background: var(--pharos-blue-500);
            color: white;
            border-color: var(--pharos-blue-500);
        }
        
        .pagination-button.active {
            background: var(--pharos-blue-500);
            color: white;
            border-color: var(--pharos-blue-500);
        }
        
        .pagination-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .header-section {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .analytics-content {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }
            
            .pie-container {
                margin: 0 auto;
            }
            
            .result-compact-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .result-activities {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .boost-cta-text {
                font-size: 16px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 20px 12px;
            }
            
            .container {
                max-width: 100%;
                padding: 0;
            }
            
            .header-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header-right {
                grid-template-columns: 1fr;
                gap: 16px;
                height: auto;
            }
            
            .header-left {
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 16px;
                min-height: auto;
            }
            
            .main-title {
                font-size: 28px;
            }
            
            .search-form {
                flex-direction: column;
                gap: 12px;
            }
            
            .input-group {
                width: 100%;
            }
            
            .search-button {
                width: 100%;
            }
            
            .analytics-content {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }
            
            .pie-container {
                margin: 0 auto;
            }
            
            .result-compact-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .result-activities {
                grid-template-columns: repeat(2, 1fr);
                order: 2;
            }
            
            .result-stat-block {
                order: 1;
            }
            
            .leaderboard-table {
                font-size: 12px;
            }
            
            .leaderboard-table th,
            .leaderboard-table td {
                padding: 8px 4px;
            }
            
            .table-container {
                max-height: 400px;
                overflow-x: auto;
            }
            
            .boost-cta-text {
                font-size: 16px;
            }
        }
        
        /* Performance: Reduce Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Progress Indicator -->
    <div class="progress-indicator" id="progressIndicator" aria-hidden="true"></div>
    
    <!-- Tooltip Container -->
    <div class="pie-tooltip" id="pieTooltip" role="tooltip"></div>
    
    <div class="container">
        <!-- Header -->
        <header class="header-section">
            <div class="header-left">
                <img src="./leaderboard_logo.webp" alt="Pharos Leaderboard Logo" class="logo-img" loading="eager">
                <div class="title-section">
                    <h1 class="main-title">Pharos<br>Testnet<br>Leaderboard</h1>
                </div>
            </div>
            
            <div class="header-right">
                <div class="stat-card-header">
                    <div class="stat-value-header">
                        <span class="stat-emoji" aria-hidden="true">üìà</span>
                        <span class="stat-number" id="totalUsers" aria-label="Total users">0</span>
                    </div>
                    <div class="stat-label-header">Total Users</div>
                </div>
                <div class="stat-card-header">
                    <div class="stat-value-header">
                        <span class="stat-emoji" aria-hidden="true">üèÜ</span>
                        <span class="stat-number" id="topPoints" aria-label="Top score">0</span>
                    </div>
                    <div class="stat-label-header">Top Score</div>
                </div>
            </div>
        </header>

        <!-- Disclaimer -->
        <section class="disclaimer-section" aria-labelledby="disclaimer-title">
            <h2 id="disclaimer-title" class="sr-only">Important Notice</h2>
            <div class="disclaimer-content">
                ‚ö†Ô∏è <strong>Disclaimer:</strong> This leaderboard only displays users who have checked their Pharos Testnet stats on platform <a href="https://pharoshub.xyz" target="_blank" rel="noopener noreferrer" class="disclaimer-link">pharoshub.xyz</a>.
            </div>
        </section>

        <!-- Search Section -->
        <section class="rank-search-section" aria-labelledby="search-title">
            <h2 id="search-title" class="sr-only">Search Your Rank</h2>
            <div class="search-form">
                <div class="input-group">
                    <label for="walletAddress" class="sr-only">Wallet Address</label>
                    <input
                        type="text"
                        class="wallet-input"
                        id="walletAddress"
                        placeholder="Enter your wallet address (0x...)"
                        spellcheck="false"
                        autocomplete="off"
                        aria-describedby="wallet-help"
                        pattern="^0x[a-fA-F0-9]{40}$"
                        required
                    >
                </div>
                <button class="search-button" id="searchButton" type="button" aria-describedby="search-help">
                    Check My Rank
                </button>
            </div>
            <div id="wallet-help" class="sr-only">Enter a valid Ethereum address starting with 0x</div>
            <div id="search-help" class="sr-only">Click to check your ranking in the leaderboard</div>
            <div class="error" id="error" role="alert" aria-live="polite"></div>
            
            <!-- User Search Result -->
            <div class="user-search-result" id="userResult" role="region" aria-labelledby="user-result-title">
                <h3 id="user-result-title" class="sr-only">Your Statistics and Rank</h3>
                <!-- Compact top row with Points, Level, and Activities -->
                <div class="result-compact-row">
                    <!-- Points -->
                    <div class="result-stat-block">
                        <div class="result-stat-value" style="color: var(--pharos-gray-900);" id="userPoints" aria-label="Your total points">0</div>
                        <div class="result-stat-label">Total Points</div>
                    </div>
                    
                    <!-- Level -->
                    <div class="result-stat-block result-level-block">
                        <div class="result-stat-value" id="userLevel" aria-label="Your current level">L1</div>
                        <div class="result-stat-label">Level</div>
                    </div>

                    <!-- Activities -->
                    <div class="result-activities">
                        <!-- Send TX -->
                        <div class="result-activity send">
                            <div class="result-activity-header">SEND TX</div>
                            <div class="result-activity-single">
                                <div class="result-activity-value" id="userSendTx" aria-label="Send transactions count">0</div>
                                <div class="result-activity-sublabel">üì§ Transfers</div>
                            </div>
                        </div>

                        <!-- Zenith -->
                        <div class="result-activity zenith">
                            <div class="result-activity-header">Zenith</div>
                            <div class="result-activity-grid">
                                <div class="result-activity-item">
                                    <div class="result-activity-value" id="userZenithSwaps" aria-label="Zenith swaps count">0</div>
                                    <div class="result-activity-sublabel">üîÑ Swaps</div>
                                </div>
                                <div class="result-activity-item">
                                    <div class="result-activity-value" id="userZenithLP" aria-label="Zenith liquidity provision count">0</div>
                                    <div class="result-activity-sublabel">üíß LP</div>
                                </div>
                            </div>
                        </div>

                        <!-- Faroswap -->
                        <div class="result-activity faroswap">
                            <div class="result-activity-header">Faroswap</div>
                            <div class="result-activity-grid">
                                <div class="result-activity-item">
                                    <div class="result-activity-value" id="userFaroswapSwaps" aria-label="Faroswap swaps count">0</div>
                                    <div class="result-activity-sublabel">üîÑ Swaps</div>
                                </div>
                                <div class="result-activity-item">
                                    <div class="result-activity-value" id="userFaroswapLP" aria-label="Faroswap liquidity provision count">0</div>
                                    <div class="result-activity-sublabel">üíß LP</div>
                                </div>
                            </div>
                        </div>

                        <!-- NFT & Domains -->
                        <div class="result-activity nft">
                            <div class="result-activity-header">NFT & Domains</div>
                            <div class="result-activity-grid">
                                <div class="result-activity-item">
                                    <div class="result-activity-value" id="userNftDomains" aria-label="Domains count">0</div>
                                    <div class="result-activity-sublabel">üåê Domains</div>
                                </div>
                                <div class="result-activity-item">
                                    <div class="result-activity-value" id="userNftNFTs" aria-label="NFTs count">0</div>
                                    <div class="result-activity-sublabel">üñºÔ∏è NFTs</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Full Width Rank -->
                <div class="rank-info">
                    <div class="rank-text" id="userRankText" aria-label="Your ranking">Your Rank: #0 out of 0</div>
                    <div class="rank-subtext" id="userRankSubtext">Loading...</div>
                </div>

                <!-- Boost CTA Block -->
                <a href="https://x.com/avzcrypto/status/1940798987709395362" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   class="boost-cta"
                   aria-label="Click to get the ultimate guide to boost your rank">
                    <div class="boost-cta-content">
                        <div class="boost-cta-text">
                            <span class="boost-cta-line1">WANT TO BOOST YOUR RANK?</span>
                            <span class="boost-cta-line2">CLICK AND GET THE ULTIMATE GUIDE</span><span class="boost-cta-emoji">üöÄ</span>
                        </div>
                    </div>
                </a>
            </div>
        </section>

        <!-- Analytics Section -->
        <section class="analytics-section" aria-labelledby="analytics-title">
            <div class="analytics-header">
                <div>
                    <h3 class="analytics-title" id="analytics-title">üìà User Distribution by Points</h3>
                    <p class="analytics-subtitle">See how users are distributed across different point tiers</p>
                </div>
            </div>
            
            <div class="analytics-content">
                <div class="pie-container">
                    <svg class="pie-chart" viewBox="0 0 280 280" id="pieChart" aria-labelledby="pie-chart-title" role="img">
                        <title id="pie-chart-title">User distribution pie chart showing percentage of users in different point tiers</title>
                        <!-- Pie slices will be generated by JavaScript -->
                    </svg>
                    <div class="pie-center-info">
                        <div class="total-users" id="pieChartTotal" aria-label="Total users in chart">0</div>
                        <div class="total-label">Total Users</div>
                    </div>
                </div>

                <div class="pie-legend" id="pieLegend" role="list" aria-label="Chart legend">
                    <!-- Legend items will be generated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Loading -->
        <div class="loading" id="loading" aria-live="polite">
            <div class="loading-text">Loading leaderboard...</div>
        </div>

        <!-- Leaderboard -->
        <main class="leaderboard-section" id="leaderboardSection" role="main">
            <div class="leaderboard-header">
                <h2 class="leaderboard-title">üèÜ Top 100 Users</h2>
            </div>
            
            <div class="table-container">
                <table class="leaderboard-table" role="table" aria-label="Pharos testnet user rankings">
                    <thead>
                        <tr>
                            <th scope="col">Rank</th>
                            <th scope="col">Address</th>
                            <th scope="col">Points & Level</th>
                            <th scope="col" style="background: rgba(59, 130, 246, 0.08);">Send TX</th>
                            <th scope="col" style="background: rgba(249, 115, 22, 0.08);">
                                <div style="text-align: center;">
                                    <div style="font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--pharos-gray-900); margin-bottom: 8px;">ZENITH</div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px; color: var(--pharos-gray-500);">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                            <div style="font-size: 12px;" aria-hidden="true">üîÑ</div>
                                            <div>Swaps</div>
                                        </div>
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                            <div style="font-size: 12px;" aria-hidden="true">üíß</div>
                                            <div>LP</div>
                                        </div>
                                    </div>
                                </div>
                            </th>
                            <th scope="col" style="background: rgba(168, 85, 247, 0.08);">
                                <div style="text-align: center;">
                                    <div style="font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--pharos-gray-900); margin-bottom: 8px;">FAROSWAP</div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px; color: var(--pharos-gray-500);">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                            <div style="font-size: 12px;" aria-hidden="true">üîÑ</div>
                                            <div>Swaps</div>
                                        </div>
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                            <div style="font-size: 12px;" aria-hidden="true">üíß</div>
                                            <div>LP</div>
                                        </div>
                                    </div>
                                </div>
                            </th>
                            <th scope="col" style="background: rgba(34, 197, 94, 0.08);">
                                <div style="text-align: center;">
                                    <div style="font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--pharos-gray-900); margin-bottom: 8px;">NFT & DOMAINS</div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px; color: var(--pharos-gray-500);">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                            <div style="font-size: 12px;" aria-hidden="true">üåê</div>
                                            <div>Domains</div>
                                        </div>
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                            <div style="font-size: 12px;" aria-hidden="true">üñºÔ∏è</div>
                                            <div>NFTs</div>
                                        </div>
                                    </div>
                                </div>
                            </th>
                            <th scope="col">Member Since</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <nav class="pagination" id="pagination" aria-label="Leaderboard pagination">
                <!-- Pagination buttons will be generated by JavaScript -->
            </nav>
        </main>
    </div>

    <script>
        'use strict';
        
        // Application State Management
        const AppState = {
            isLoading: false,
            currentUser: null,
            leaderboardData: null,
            currentPage: 1,
            itemsPerPage: 20,
            error: null,
            cache: new Map(),
            tooltipElement: null,
            lastRequestTime: 0,
            abortController: null
        };
        
        // Configuration
        const CONFIG = {
            CACHE_TTL: 5 * 60 * 1000, // 5 minutes
            REQUEST_DELAY: 2000, // 2 seconds between requests
            MAX_RETRIES: 3,
            RETRY_DELAY: 1000
        };
        
        // Performance monitoring
        const performanceObserver = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
                if (entry.entryType === 'navigation') {
                    console.log(`Page load time: ${Math.round(entry.loadEventEnd - entry.loadEventStart)}ms`);
                }
            }
        });
        
        try {
            performanceObserver.observe({ entryTypes: ['navigation'] });
        } catch (e) {
            // Silently fail for older browsers
        }
        
        // DOM Elements Cache
        const elements = {
            walletInput: document.getElementById('walletAddress'),
            searchButton: document.getElementById('searchButton'),
            error: document.getElementById('error'),
            userResult: document.getElementById('userResult'),
            loading: document.getElementById('loading'),
            leaderboardSection: document.getElementById('leaderboardSection'),
            leaderboardBody: document.getElementById('leaderboardBody'),
            progressIndicator: document.getElementById('progressIndicator'),
            pieTooltip: document.getElementById('pieTooltip'),
            
            // Header stats
            totalUsers: document.getElementById('totalUsers'),
            topPoints: document.getElementById('topPoints'),
            
            // User result elements
            userPoints: document.getElementById('userPoints'),
            userLevel: document.getElementById('userLevel'),
            userSendTx: document.getElementById('userSendTx'),
            userRankText: document.getElementById('userRankText'),
            userRankSubtext: document.getElementById('userRankSubtext'),
            userZenithSwaps: document.getElementById('userZenithSwaps'),
            userZenithLP: document.getElementById('userZenithLP'),
            userFaroswapSwaps: document.getElementById('userFaroswapSwaps'),
            userFaroswapLP: document.getElementById('userFaroswapLP'),
            userNftDomains: document.getElementById('userNftDomains'),
            userNftNFTs: document.getElementById('userNftNFTs'),
            
            // Analytics elements
            pieChart: document.getElementById('pieChart'),
            pieLegend: document.getElementById('pieLegend'),
            pieChartTotal: document.getElementById('pieChartTotal'),
            pagination: document.getElementById('pagination')
        };
        
        // Utility Functions
        const utils = {
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func.apply(this, args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            
            throttle(func, limit) {
                let inThrottle;
                return function(...args) {
                    if (!inThrottle) {
                        func.apply(this, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },
            
            isValidAddress(address) {
                return /^0x[a-fA-F0-9]{40}$/.test(address);
            },
            
            formatNumber(num) {
                return new Intl.NumberFormat('en-US').format(Math.max(0, num));
            },
            
            sanitizeInput(input) {
                return input.trim().toLowerCase();
            },
            
            sanitizeText(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },
            
            createSafeElement(tag, props = {}, children = []) {
                const element = document.createElement(tag);
                
                Object.entries(props).forEach(([key, value]) => {
                    if (key === 'textContent') {
                        element.textContent = value;
                    } else if (key === 'innerHTML') {
                        // Only allow safe HTML
                        element.innerHTML = utils.sanitizeText(value);
                    } else {
                        element.setAttribute(key, value);
                    }
                });
                
                children.forEach(child => {
                    if (typeof child === 'string') {
                        element.appendChild(document.createTextNode(child));
                    } else {
                        element.appendChild(child);
                    }
                });
                
                return element;
            }
        };
        
        // Cache Management
        const cache = {
            set(key, data, ttl = CONFIG.CACHE_TTL) {
                AppState.cache.set(key, {
                    data,
                    expires: Date.now() + ttl
                });
            },
            
            get(key) {
                const cached = AppState.cache.get(key);
                if (!cached) return null;
                
                if (Date.now() > cached.expires) {
                    AppState.cache.delete(key);
                    return null;
                }
                
                return cached.data;
            },
            
            clear() {
                AppState.cache.clear();
            }
        };
        
        // API Functions with retry logic
        async function fetchWithRetry(url, options = {}, maxRetries = CONFIG.MAX_RETRIES) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, CONFIG.RETRY_DELAY * (i + 1)));
                }
            }
        }
        
        // UI State Management
        const ui = {
            showError(message, type = 'validation') {
                elements.error.textContent = message;
                elements.error.classList.add('show');
                elements.userResult.classList.remove('show');
                elements.error.focus();
                console.error(`UI Error [${type}]:`, message);
            },
            
            hideError() {
                elements.error.classList.remove('show');
                elements.error.textContent = '';
            },
            
            showLoading() {
                AppState.isLoading = true;
                elements.progressIndicator.classList.add('loading');
                elements.loading.classList.add('show');
                elements.userResult.classList.remove('show');
                elements.leaderboardSection.style.display = 'none';
                this.hideError();
                elements.searchButton.disabled = true;
                elements.searchButton.textContent = 'Checking...';
                elements.walletInput.setAttribute('aria-busy', 'true');
            },
            
            hideLoading() {
                AppState.isLoading = false;
                elements.progressIndicator.classList.remove('loading');
                elements.loading.classList.remove('show');
                elements.leaderboardSection.style.display = 'block';
                elements.searchButton.disabled = false;
                elements.searchButton.textContent = 'Check My Rank';
                elements.walletInput.setAttribute('aria-busy', 'false');
            },
            
            showTooltip(content, x, y) {
                this.hideTooltip();
                elements.pieTooltip.innerHTML = content;
                elements.pieTooltip.style.left = `${x + 10}px`;
                elements.pieTooltip.style.top = `${y - 10}px`;
                elements.pieTooltip.classList.add('show');
            },
            
            hideTooltip() {
                elements.pieTooltip.classList.remove('show');
                elements.pieTooltip.innerHTML = '';
            },
            
            animateValue(element, start, end, duration = 1000) {
                const startTime = performance.now();
                const range = end - start;
                let animationId;
                
                const update = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                    
                    const current = start + (range * easeOutQuart);
                    element.textContent = utils.formatNumber(Math.floor(current));
                    
                    if (progress < 1) {
                        animationId = requestAnimationFrame(update);
                    } else {
                        element.textContent = utils.formatNumber(end);
                    }
                };
                
                animationId = requestAnimationFrame(update);
                
                // Return cleanup function
                return () => {
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                    }
                };
            }
        };
        
        // Business Logic Functions
        function getRankTier(points) {
            if (points >= 10000) return 'rank-tier-1';
            if (points >= 9000) return 'rank-tier-2';
            if (points >= 8000) return 'rank-tier-3';
            if (points >= 7000) return 'rank-tier-4';
            if (points >= 6000) return 'rank-tier-5';
            if (points >= 5000) return 'rank-tier-6';
            if (points >= 4000) return 'rank-tier-7';
            if (points >= 3000) return 'rank-tier-8';
            if (points >= 2000) return 'rank-tier-9';
            return 'rank-tier-10';
        }
        
        function calculateLevel(points) {
            if (points < 1000) return 1;
            if (points < 3000) return 2;
            if (points < 6000) return 3;
            return Math.min(4, Math.floor(points / 1500)); // Max level 4
        }
        
        function formatAddress(address) {
            if (!address || typeof address !== 'string') return 'Unknown';
            return `${address.slice(0, 4)}...${address.slice(-4)}`;
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            } catch (e) {
                return 'Unknown';
            }
        }
        
        // Rate limiting
        function checkRateLimit() {
            const now = Date.now();
            if (now - AppState.lastRequestTime < CONFIG.REQUEST_DELAY) {
                const waitTime = CONFIG.REQUEST_DELAY - (now - AppState.lastRequestTime);
                throw new Error(`Please wait ${Math.ceil(waitTime / 1000)} seconds before making another request`);
            }
            AppState.lastRequestTime = now;
        }
        
        // Main API Functions
        async function searchUserRank() {
            const address = utils.sanitizeInput(elements.walletInput.value);
            
            if (!address) {
                ui.showError('Please enter a wallet address');
                elements.walletInput.focus();
                return;
            }
            
            if (!utils.isValidAddress(address)) {
                ui.showError('Please enter a valid Ethereum address (42 characters starting with 0x)');
                elements.walletInput.focus();
                return;
            }
            
            try {
                checkRateLimit();
            } catch (e) {
                ui.showError(e.message, 'rate_limit');
                return;
            }
            
            ui.hideError();
            ui.showLoading();
            
            // Abort previous request if exists
            if (AppState.abortController) {
                AppState.abortController.abort();
            }
            
            AppState.abortController = new AbortController();
            
            try {
                // Check cache first
                const cacheKey = `user_${address}`;
                let userData = cache.get(cacheKey);
                
                if (!userData) {
                    const userResponse = await fetchWithRetry('/api/check-wallet', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            wallet_address: address
                        }),
                        signal: AppState.abortController.signal
                    });
                    
                    userData = await userResponse.json();
                    if (!userData.success) {
                        throw new Error(userData.error || 'Failed to fetch user data');
                    }
                    
                    cache.set(cacheKey, userData, 2 * 60 * 1000); // 2 minutes cache for user data
                }
                
                // Get leaderboard data
                let leaderboardData = cache.get('leaderboard');
                if (!leaderboardData) {
                    const leaderboardResponse = await fetchWithRetry('/api/admin/stats', {
                        signal: AppState.abortController.signal
                    });
                    
                    leaderboardData = await leaderboardResponse.json();
                    if (!leaderboardData.success) {
                        throw new Error(leaderboardData.error || 'Failed to fetch leaderboard data');
                    }
                    
                    cache.set('leaderboard', leaderboardData);
                }
                
                displayUserResult(userData, leaderboardData);
                
            } catch (err) {
                if (err.name === 'AbortError') {
                    return; // Request was cancelled
                }
                
                console.error('Search error:', err);
                
                let errorMessage = 'Failed to fetch data. Please try again.';
                let errorType = 'api';
                
                if (err.message.includes('Network')) {
                    errorMessage = 'Network error. Please check your connection.';
                    errorType = 'network';
                } else if (err.message.includes('timeout')) {
                    errorMessage = 'Request timeout. Please try again.';
                    errorType = 'timeout';
                } else if (err.message) {
                    errorMessage = err.message;
                }
                
                ui.showError(errorMessage, errorType);
            } finally {
                ui.hideLoading();
                AppState.abortController = null;
            }
        }
        
        function displayUserResult(userData, leaderboardData) {
            ui.hideError();
            
            // Sanitize and validate data
            const safeUserData = {
                total_points: Math.max(0, parseInt(userData.total_points) || 0),
                send_count: Math.max(0, parseInt(userData.send_count) || 0),
                zenith_swaps: Math.max(0, parseInt(userData.zenith_swaps) || 0),
                zenith_lp: Math.max(0, parseInt(userData.zenith_lp) || 0),
                faroswap_swaps: Math.max(0, parseInt(userData.faroswap_swaps) || 0),
                faroswap_lp: Math.max(0, parseInt(userData.faroswap_lp) || 0),
                mint_domain: Math.max(0, parseInt(userData.mint_domain) || 0),
                mint_nft: Math.max(0, parseInt(userData.mint_nft) || 0),
                exact_rank: userData.exact_rank
            };
            
            // Update user stats with animations
            ui.animateValue(elements.userPoints, 0, safeUserData.total_points);
            ui.animateValue(elements.userSendTx, 0, safeUserData.send_count);
            ui.animateValue(elements.userZenithSwaps, 0, safeUserData.zenith_swaps);
            ui.animateValue(elements.userZenithLP, 0, safeUserData.zenith_lp);
            ui.animateValue(elements.userFaroswapSwaps, 0, safeUserData.faroswap_swaps);
            ui.animateValue(elements.userFaroswapLP, 0, safeUserData.faroswap_lp);
            ui.animateValue(elements.userNftDomains, 0, safeUserData.mint_domain);
            ui.animateValue(elements.userNftNFTs, 0, safeUserData.mint_nft);
            
            elements.userLevel.textContent = `L${calculateLevel(safeUserData.total_points)}`;
            
            // Display rank information
            const totalUsers = Math.max(0, parseInt(leaderboardData.total_users) || 0);
            
            if (safeUserData.exact_rank && totalUsers > 0) {
                const userRank = Math.max(1, parseInt(safeUserData.exact_rank));
                const percentile = ((totalUsers - userRank) / totalUsers * 100).toFixed(2);
                
                elements.userRankText.textContent = `Your Rank: #${utils.formatNumber(userRank)} out of ${utils.formatNumber(totalUsers)}`;
                elements.userRankSubtext.textContent = `You're in the top ${percentile}% of all users! üéâ`;
            } else {
                elements.userRankText.textContent = `Your Rank: Not available`;
                elements.userRankSubtext.textContent = `Rank calculation requires stats to be enabled on the server`;
            }
            
            elements.userResult.classList.add('show');
            AppState.currentUser = safeUserData;
        }
        
        async function loadLeaderboard() {
            try {
                ui.showLoading();
                
                let data = cache.get('leaderboard');
                if (!data) {
                    const response = await fetchWithRetry('/api/admin/stats');
                    data = await response.json();
                    
                    if (!data.success) {
                        throw new Error(data.error || 'Failed to fetch leaderboard');
                    }
                    
                    cache.set('leaderboard', data);
                }
                
                AppState.leaderboardData = data;
                displayLeaderboard(data);
                updateAnalytics(data);
                updateHeaderStats(data);
                
            } catch (err) {
                console.error('Error loading leaderboard:', err);
                ui.showError(`Failed to load leaderboard: ${err.message}`, 'api');
            } finally {
                ui.hideLoading();
            }
        }
        
        function displayLeaderboard(data) {
            if (!data.leaderboard || !Array.isArray(data.leaderboard)) {
                ui.showError('Invalid leaderboard data received', 'data');
                return;
            }
            
            const tbody = elements.leaderboardBody;
            const startIndex = (AppState.currentPage - 1) * AppState.itemsPerPage;
            const endIndex = startIndex + AppState.itemsPerPage;
            const pageData = data.leaderboard.slice(startIndex, endIndex);
            
            // Clear existing content
            tbody.innerHTML = '';
            
            // Create document fragment for better performance
            const fragment = document.createDocumentFragment();
            
            pageData.forEach((user) => {
                // Sanitize user data
                const safeUser = {
                    rank: Math.max(1, parseInt(user.rank) || 1),
                    address: user.address || 'Unknown',
                    total_points: Math.max(0, parseInt(user.total_points) || 0),
                    send_count: Math.max(0, parseInt(user.send_count) || 0),
                    swap_count: Math.max(0, parseInt(user.swap_count) || 0),
                    lp_count: Math.max(0, parseInt(user.lp_count) || 0),
                    faroswap_swaps: Math.max(0, parseInt(user.faroswap_swaps) || 0),
                    faroswap_lp: Math.max(0, parseInt(user.faroswap_lp) || 0),
                    mint_domain: Math.max(0, parseInt(user.mint_domain) || 0),
                    mint_nft: Math.max(0, parseInt(user.mint_nft) || 0),
                    member_since: user.member_since
                };
                
                const row = utils.createSafeElement('tr');
                const rankClass = getRankTier(safeUser.total_points);
                const level = calculateLevel(safeUser.total_points);
                
                // Create cells safely
                const rankCell = utils.createSafeElement('td');
                const rankSpan = utils.createSafeElement('span', {
                    class: `rank ${rankClass}`,
                    textContent: `#${safeUser.rank}`
                });
                rankCell.appendChild(rankSpan);
                
                const addressCell = utils.createSafeElement('td', {
                    class: 'address',
                    textContent: formatAddress(safeUser.address)
                });
                
                const pointsLevelCell = utils.createSafeElement('td');
                const pointsWrapper = utils.createSafeElement('div', { class: 'points-level-wrapper' });
                const pointsSpan = utils.createSafeElement('span', {
                    class: 'points',
                    textContent: utils.formatNumber(safeUser.total_points)
                });
                const levelBadge = utils.createSafeElement('span', {
                    class: 'level-badge',
                    textContent: `L${level}`
                });
                pointsWrapper.appendChild(pointsSpan);
                pointsWrapper.appendChild(levelBadge);
                pointsLevelCell.appendChild(pointsWrapper);
                
                const sendCell = utils.createSafeElement('td');
                const sendBlock = utils.createSafeElement('div', {
                    class: 'send-block protocol-block',
                    style: 'display: grid; grid-template-columns: 1fr 1fr; gap: 8px; text-align: center; padding: 4px; border-radius: 8px;'
                });
                const sendCount = utils.createSafeElement('div', {
                    class: 'activity-count',
                    textContent: safeUser.send_count
                });
                const sendEmpty = utils.createSafeElement('div', {
                    class: 'activity-count',
                    style: 'opacity: 0;'
                });
                sendBlock.appendChild(sendCount);
                sendBlock.appendChild(sendEmpty);
                sendCell.appendChild(sendBlock);
                
                const zenithCell = utils.createSafeElement('td');
                const zenithBlock = utils.createSafeElement('div', {
                    class: 'zenith-block protocol-block',
                    style: 'display: grid; grid-template-columns: 1fr 1fr; gap: 8px; text-align: center; padding: 4px; border-radius: 8px;'
                });
                const zenithSwaps = utils.createSafeElement('div', {
                    class: 'activity-count',
                    textContent: safeUser.swap_count
                });
                const zenithLP = utils.createSafeElement('div', {
                    class: 'activity-count',
                    textContent: safeUser.lp_count
                });
                zenithBlock.appendChild(zenithSwaps);
                zenithBlock.appendChild(zenithLP);
                zenithCell.appendChild(zenithBlock);
                
                const faroswapCell = utils.createSafeElement('td');
                const faroswapBlock = utils.createSafeElement('div', {
                    class: 'faroswap-block protocol-block',
                    style: 'display: grid; grid-template-columns: 1fr 1fr; gap: 8px; text-align: center; padding: 4px; border-radius: 8px;'
                });
                const faroswapSwaps = utils.createSafeElement('div', {
                    class: 'activity-count',
                    textContent: safeUser.faroswap_swaps
                });
                const faroswapLP = utils.createSafeElement('div', {
                    class: 'activity-count',
                    textContent: safeUser.faroswap_lp
                });
                faroswapBlock.appendChild(faroswapSwaps);
                faroswapBlock.appendChild(faroswapLP);
                faroswapCell.appendChild(faroswapBlock);
                
                const nftCell = utils.createSafeElement('td');
                const nftBlock = utils.createSafeElement('div', {
                    class: 'nft-block protocol-block',
                    style: 'display: grid; grid-template-columns: 1fr 1fr; gap: 8px; text-align: center; padding: 4px; border-radius: 8px;'
                });
                const domains = utils.createSafeElement('div', {
                    class: 'activity-count',
                    textContent: safeUser.mint_domain
                });
                const nfts = utils.createSafeElement('div', {
                    class: 'activity-count',
                    textContent: safeUser.mint_nft
                });
                nftBlock.appendChild(domains);
                nftBlock.appendChild(nfts);
                nftCell.appendChild(nftBlock);
                
                const memberCell = utils.createSafeElement('td', {
                    class: 'member-since',
                    textContent: formatDate(safeUser.member_since)
                });
                
                // Append all cells to row
                [rankCell, addressCell, pointsLevelCell, sendCell, zenithCell, faroswapCell, nftCell, memberCell].forEach(cell => {
                    row.appendChild(cell);
                });
                
                fragment.appendChild(row);
            });
            
            tbody.appendChild(fragment);
            
            // Update pagination
            updatePagination(data);
        }
        
        function updatePagination(data) {
            const totalItems = data.leaderboard ? data.leaderboard.length : 0;
            const totalPages = Math.ceil(totalItems / AppState.itemsPerPage);
            
            if (totalPages <= 1) {
                elements.pagination.style.display = 'none';
                return;
            }
            
            elements.pagination.style.display = 'flex';
            elements.pagination.innerHTML = '';
            
            // Previous button
            const prevButton = utils.createSafeElement('button', {
                class: `pagination-button ${AppState.currentPage === 1 ? 'disabled' : ''}`,
                textContent: '‚Äπ',
                'aria-label': 'Previous page'
            });
            if (AppState.currentPage > 1) {
                prevButton.addEventListener('click', () => {
                    AppState.currentPage--;
                    displayLeaderboard(data);
                    elements.leaderboardSection.scrollIntoView({ behavior: 'smooth' });
                });
            }
            elements.pagination.appendChild(prevButton);
            
            // Page numbers
            const startPage = Math.max(1, AppState.currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = utils.createSafeElement('button', {
                    class: `pagination-button ${i === AppState.currentPage ? 'active' : ''}`,
                    textContent: i,
                    'aria-label': `Page ${i}`
                });
                pageButton.addEventListener('click', () => {
                    AppState.currentPage = i;
                    displayLeaderboard(data);
                    elements.leaderboardSection.scrollIntoView({ behavior: 'smooth' });
                });
                elements.pagination.appendChild(pageButton);
            }
            
            // Next button
            const nextButton = utils.createSafeElement('button', {
                class: `pagination-button ${AppState.currentPage === totalPages ? 'disabled' : ''}`,
                textContent: '‚Ä∫',
                'aria-label': 'Next page'
            });
            if (AppState.currentPage < totalPages) {
                nextButton.addEventListener('click', () => {
                    AppState.currentPage++;
                    displayLeaderboard(data);
                    elements.leaderboardSection.scrollIntoView({ behavior: 'smooth' });
                });
            }
            elements.pagination.appendChild(nextButton);
        }
        
        function updateHeaderStats(data) {
            ui.animateValue(elements.totalUsers, 0, Math.max(0, parseInt(data.total_users) || 0));
            
            if (data.leaderboard && data.leaderboard.length > 0) {
                const topPoints = Math.max(0, parseInt(data.leaderboard[0].total_points) || 0);
                ui.animateValue(elements.topPoints, 0, topPoints);
            }
        }
        
        function updateAnalytics(data) {
            const tiers = [
                { name: '10,000+ Points', min: 10000, color: '#dc2626' },
                { name: '9,000 - 9,999 Points', min: 9000, max: 9999, color: '#ea580c' },
                { name: '8,000 - 8,999 Points', min: 8000, max: 8999, color: '#d97706' },
                { name: '7,000 - 7,999 Points', min: 7000, max: 7999, color: '#059669' },
                { name: '6,000 - 6,999 Points', min: 6000, max: 6999, color: '#0891b2' },
                { name: '5,000 - 5,999 Points', min: 5000, max: 5999, color: '#2563eb' },
                { name: '4,000 - 4,999 Points', min: 4000, max: 4999, color: '#7c3aed' },
                { name: '3,000 - 3,999 Points', min: 3000, max: 3999, color: '#c026d3' },
                { name: 'Below 3,000 Points', min: 0, max: 2999, color: '#6b7280' }
            ];
            
            const totalUsers = Math.max(0, parseInt(data.total_users) || 0);
            const topUsersCount = data.leaderboard ? data.leaderboard.length : 0;
            
            // Calculate distribution using ORIGINAL logic with realistic coefficients
            const distribution = tiers.map(tier => {
                // Count users from leaderboard data
                let topCount = 0;
                if (data.leaderboard && Array.isArray(data.leaderboard)) {
                    topCount = data.leaderboard.filter(user => {
                        const points = Math.max(0, parseInt(user.total_points) || 0);
                        if (tier.max !== undefined) {
                            return points >= tier.min && points <= tier.max;
                        } else {
                            return points >= tier.min;
                        }
                    }).length;
                }
                
                // Realistic extrapolation for full user base (ORIGINAL LOGIC RESTORED)
                let estimatedCount;
                if (totalUsers > topUsersCount && topUsersCount > 0) {
                    if (tier.name === '10,000+ Points') {
                        // High scores - only in top users, very rare outside
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.0005);
                    } else if (tier.name === '9,000 - 9,999 Points') {
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.002);
                    } else if (tier.name === '8,000 - 8,999 Points') {
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.008);
                    } else if (tier.name === '7,000 - 7,999 Points') {
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.020);
                    } else if (tier.name === '6,000 - 6,999 Points') {
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.035);
                    } else if (tier.name === '5,000 - 5,999 Points') {
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.055);
                    } else if (tier.name === '4,000 - 4,999 Points') {
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.080);
                    } else if (tier.name === '3,000 - 3,999 Points') {
                        estimatedCount = topCount + Math.floor((totalUsers - topUsersCount) * 0.120);
                    } else if (tier.name === 'Below 3,000 Points') {
                        // Most users have low scores - calculate remaining
                        const usedCount = tiers.slice(0, -1).reduce((sum, t, index) => {
                            const rates = [0.0005, 0.002, 0.008, 0.020, 0.035, 0.055, 0.080, 0.120];
                            const tierTopCount = data.leaderboard.filter(user => {
                                const points = Math.max(0, parseInt(user.total_points) || 0);
                                if (t.max !== undefined) {
                                    return points >= t.min && points <= t.max;
                                } else {
                                    return points >= t.min;
                                }
                            }).length;
                            return sum + tierTopCount + Math.floor((totalUsers - topUsersCount) * rates[index]);
                        }, 0);
                        estimatedCount = Math.max(0, totalUsers - usedCount);
                    }
                } else {
                    estimatedCount = topCount;
                }
                
                return {
                    ...tier,
                    count: Math.max(0, estimatedCount),
                    percentage: totalUsers > 0 ? ((estimatedCount / totalUsers) * 100).toFixed(1) : '0.0'
                };
            });
            
            renderPieChart(distribution, totalUsers);
            renderLegend(distribution);
        }
        
        function renderPieChart(distribution, totalUsers) {
            ui.animateValue(elements.pieChartTotal, 0, totalUsers);
            
            // Clear existing chart
            elements.pieChart.innerHTML = '';
            
            if (totalUsers === 0) return;
            
            let currentAngle = 0;
            const radius = 110;
            const circumference = 2 * Math.PI * radius;
            
            distribution.forEach((tier, index) => {
                if (tier.count > 0) {
                    const percentage = tier.count / totalUsers;
                    const strokeDasharray = `${percentage * circumference} ${circumference}`;
                    const strokeDashoffset = -currentAngle * circumference;
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', '140');
                    circle.setAttribute('cy', '140');
                    circle.setAttribute('r', radius);
                    circle.setAttribute('fill', 'none');
                    circle.setAttribute('stroke', tier.color);
                    circle.setAttribute('stroke-width', '30');
                    circle.setAttribute('stroke-dasharray', strokeDasharray);
                    circle.setAttribute('stroke-dashoffset', strokeDashoffset);
                    circle.style.cursor = 'pointer';
                    circle.style.transition = 'stroke-width 0.3s ease';
                    circle.setAttribute('aria-label', `${tier.name}: ${tier.count} users (${tier.percentage}%)`);
                    
                    // Event listeners with proper cleanup
                    const mouseEnterHandler = (e) => {
                        circle.setAttribute('stroke-width', '35');
                        const content = `
                            <div style="color: ${tier.color}; font-weight: 700; margin-bottom: 4px;">${utils.sanitizeText(tier.name)}</div>
                            <div>${utils.formatNumber(tier.count)} users (${tier.percentage}%)</div>
                        `;
                        ui.showTooltip(content, e.clientX, e.clientY);
                    };
                    
                    const mouseLeaveHandler = () => {
                        circle.setAttribute('stroke-width', '30');
                        ui.hideTooltip();
                    };
                    
                    const mouseMoveHandler = (e) => {
                        if (elements.pieTooltip.classList.contains('show')) {
                            elements.pieTooltip.style.left = `${e.clientX + 10}px`;
                            elements.pieTooltip.style.top = `${e.clientY - 10}px`;
                        }
                    };
                    
                    circle.addEventListener('mouseenter', mouseEnterHandler);
                    circle.addEventListener('mouseleave', mouseLeaveHandler);
                    circle.addEventListener('mousemove', mouseMoveHandler);
                    
                    elements.pieChart.appendChild(circle);
                    currentAngle += percentage;
                }
            });
        }
        
        function renderLegend(distribution) {
            elements.pieLegend.innerHTML = '';
            
            const fragment = document.createDocumentFragment();
            
            distribution.forEach(tier => {
                const fillPercentage = Math.max(0, parseFloat(tier.percentage));
                
                const item = utils.createSafeElement('div', {
                    class: 'legend-item',
                    role: 'listitem',
                    style: `background: linear-gradient(to right, 
                        ${tier.color}25 0%, 
                        ${tier.color}25 ${fillPercentage}%, 
                        rgba(255, 255, 255, 0.8) ${fillPercentage}%, 
                        rgba(255, 255, 255, 0.8) 100%)`
                });
                
                const colorDiv = utils.createSafeElement('div', {
                    class: 'legend-color',
                    style: `background: ${tier.color};`
                });
                
                const textDiv = utils.createSafeElement('div', {
                    class: 'legend-text',
                    textContent: tier.name
                });
                
                const countDiv = utils.createSafeElement('div', {
                    class: 'legend-count',
                    textContent: utils.formatNumber(tier.count)
                });
                
                const percentageDiv = utils.createSafeElement('div', {
                    class: 'legend-percentage',
                    textContent: `${tier.percentage}%`
                });
                
                [colorDiv, textDiv, countDiv, percentageDiv].forEach(el => {
                    item.appendChild(el);
                });
                
                fragment.appendChild(item);
            });
            
            elements.pieLegend.appendChild(fragment);
        }
        
        // Event Listeners with proper cleanup
        const debouncedSearch = utils.debounce(searchUserRank, 1000);
        elements.searchButton.addEventListener('click', debouncedSearch);
        
        elements.walletInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                debouncedSearch();
            }
        });
        
        const debouncedInputHandler = utils.debounce(() => {
            ui.hideError();
            elements.userResult.classList.remove('show');
            
            const value = utils.sanitizeInput(elements.walletInput.value);
            if (value && !utils.isValidAddress(value)) {
                elements.walletInput.setAttribute('aria-invalid', 'true');
            } else {
                elements.walletInput.setAttribute('aria-invalid', 'false');
            }
        }, 300);
        
        elements.walletInput.addEventListener('input', debouncedInputHandler);
        
        // Paste event optimization
        elements.walletInput.addEventListener('paste', (e) => {
            setTimeout(() => {
                const value = utils.sanitizeInput(elements.walletInput.value);
                if (utils.isValidAddress(value)) {
                    ui.hideError();
                    elements.walletInput.setAttribute('aria-invalid', 'false');
                }
            }, 0);
        });
        
        // Global error handling
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
        });
        
        // Online/Offline detection
        window.addEventListener('online', () => {
            ui.hideError();
            elements.searchButton.disabled = false;
            cache.clear(); // Clear cache when coming back online
        });
        
        window.addEventListener('offline', () => {
            ui.showError('You are offline. Please check your connection.', 'offline');
            elements.searchButton.disabled = true;
        });
        
        // Page visibility API for cache management
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden, clean up resources
                ui.hideTooltip();
                if (AppState.abortController) {
                    AppState.abortController.abort();
                }
            } else {
                // Page is visible, refresh data if cache is stale
                const leaderboardCache = cache.get('leaderboard');
                if (!leaderboardCache && !AppState.isLoading) {
                    loadLeaderboard();
                }
            }
        });
        
        // Initialize app
        (function init() {
            // Set initial ARIA attributes
            elements.userResult.setAttribute('aria-hidden', 'true');
            elements.walletInput.setAttribute('aria-busy', 'false');
            elements.walletInput.setAttribute('aria-invalid', 'false');
            
            // Focus management
            elements.walletInput.focus();
            
            // Check if we're online
            if (!navigator.onLine) {
                ui.showError('You are offline. Please check your connection.', 'offline');
                elements.searchButton.disabled = true;
                return;
            }
            
            // Load initial data
            loadLeaderboard();
            
            // Preload critical images
            const criticalImages = ['./leaderboard_logo.webp', './form_background.webp'];
            criticalImages.forEach(src => {
                const img = new Image();
                img.src = src;
            });
            
            console.log('Pharos Leaderboard initialized successfully');
        })();
    </script>
</body>
</html>
